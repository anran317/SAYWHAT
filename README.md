# SAYWAHT语音识别程序说明文档

#### 目录

1. [程序设计目的](#1)

2. [程序设计目标与设计说明](#2)

​       2.1 [设计目标](#21)

​       2.2 [设计说明](#22)

3. [具体设计步骤](#3)

​       3.1 [后端程序的具体设计步骤](#31)

​       3.2 [前端程序的具体设计步骤](#32)

-----------

### 1. 程序设计目的<a name="1"></a>

本次语音识别程序的设计是对后端开发和前端设计的一次综合性学习，需要基于开源/第三方语音识别API（讯飞），编写图形界面程序并实现语音识别功能。通过该程序的设计，学会如何将前端和后端联系起来，实现从前端获取数据并存入后端，以及后端提取新的数据使前端界面更新。

### 2. 程序设计目标与设计说明<a name="2"></a>

#### 2.1 设计目标<a name="21"></a>

实现一个完整的微信语音识别小程序——SAYWHAT语音识别。其中包含功能有看图猜物、中英互译。

与图片中的内容进行匹配，只要录音内容中包含小动物的名字，即可显示结果正确，否则显示结果错误。

“中英互译”部分能够实现中英文在线同步翻译。分为中英文两个按钮，长按“中文”按钮进行录音（中文），松手后即可显示语音识别结果和英文翻译，长按“英文”按钮同理。对于每次录音的语音识别结果都能进行修改，修改完成后，相应的翻译也会自动修改。另外还可以复制语音识别的原文或译文。

#### 2.2 设计说明<a name="22"></a>

程序文件夹内“backend”为后端代码文件，“frontend”为前端代码文件，“pictures”为真机调试过程中部分截图。

后端的功能主要包括三个模块，分别是用户权限（user）、音频上传（upload）、语音识别和结果判断（recognize）。

前端部分主要实现三个页面，分别是看图猜物（index）、中英互译主界面（logs）、中英互译副界面（edit）。

**该前端页面中所有按钮、背景等部分均由小组成员绘制而成，在契合“小动物”主题的基础上，加上了“SAYWHAT”的水印。**

### 3. 具体设计步骤<a name="3"></a>

#### 3.1 后端程序的具体设计步骤<a name="31"></a>

##### 3.1.1 Django后端

##### ① 语言环境

python >= 3.6

##### ② 依赖安装

```shell script
pip install -r requirements.txt
```

##### ③ 开启Web服务

```shell script
python manage.py runserver 0.0.0.0:8765
```

##### 3.1.2 服务（service）

实现子服务upload、recognize和user的URL入口。

```python
urlpatterns = [
    re_path(r'^upload/', include('upload.urls')),
    re_path(r'^recognize/', include('recognize.urls')),
    re_path(r'^user/', include('user.urls')),
]
```

在`responseUtil.py`中主要实现三个响应函数，分别对应请求成功时的响应、请求失败时的响应和服务器内部错误的响应。

##### 3.1.3 用户权限（user）

实现微信用户的openid的获取，作为唯一的UID。

##### 3.1.4 音频上传（upload）

主要实现两个函数，分别为：

①`uploadSpeech(request)`：获取上传的音频并进行存储。

②`clearSpeechByUid(request)`：清除包含该UID的所有音频。

##### 3.1.5 语音识别和结果判断（recognize）

导入`xunfei_speech_rec.py`,实现讯飞应用--语音转写服务。

在`view.py`中构造函数分别实现以下功能：

①去除句子中标点符号

②获取讯飞语音识别结果

③判断标准答案列表（media/img_answer/VE+数字/Answer.txt）中的词语是否在识别文本中

④获取随机图片

⑤获取语音识别及判定结果

#### 3.2 前端程序的具体设计步骤<a name="32"></a>

##### 3.2.1 `app.json`中的声明

①声明引用了插件**微信同声传译**，版本号0.3.5：

```json
"plugins": {
    "WechatSI": {
      "version": "0.3.5",
      "provider": "wx069ba97219f66d99"
    }
 },
```

②声明有三个界面：

```json
"pages": [
    "pages/index/index",
    "pages/edit/edit",
    "pages/logs/logs"
  ],
```

##### 3.2.2 看图猜物（pages/index）

分为四个部分：

①图片显示：从后台随机调取图片并显示。

②更换图片按键：分为`text`“更换图片”、`image`“代表更新的符号”，该image实现按钮作用，点击时调用`changeImage`函数，获取后台随机图片。

③开始/停止录音按键：按下“麦克风”形状按键开始录音，“冰块”形状按键停止录音。录音文件被上传到后台。

④识别音频按键：录音结束后，按下“识别音频”，即可弹出结果框，内容包括语音转文字、识别结果，识别出的文字旁边还有播放按钮，点击即可播放录音。

##### 3.2.3 中英互译主界面（pages/logs）

初始界面为一个对话框，内容为等待说话。界面下方有两个按钮“中文”和“EN”，分别提示“ 长按说话”和“Hold To Talk”，长按“中文”说出中文句子，松手后可以识别出文字并翻译成英文，翻译结果会自动播放；“EN”按键同理。

每个对话框上面都有录音的日期和时间，对话框内有两个按钮，分别是播放译文、修改原文，**点击修改原文进入中英互译副界面**。

长按对话框出现三个选项，分别是复制原文、复制译文、删除操作。

##### 3.2.4 中英互译副界面（pages/edit）

进入界面后，可以随意输入文字，左下角有文字提示“还能输入xx个字”，右下角垃圾桶标志代表将输入的内容全部删除。点击完成后，返回到**中英互译主界面**，发现原文已经被修改，出现新的译文。



